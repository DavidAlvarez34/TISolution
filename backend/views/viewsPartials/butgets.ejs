<div class="container">
  <div class="row mt-5">
    <div class="col-md-7">
      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal2">
        crear presupuesto
      </button>
      <table class="table table-bordered table-hover table-dark">
        <h2>Presupuestos</h2>
        <thead>
          <tr>
            <td>Id presupuesto</td>
            <td>Fecha de creacion</td>
            <td>Proyecto</td>
            <td>Version</td>
            <td>Actions</td>
          </tr>
        </thead>
        <tbody>
          <!--Si hay datos los recorre por un bloque for-->
          <% if (data) { %>
            <% for(var i=0; i < data.length; i++) { %>
              <tr>
                <td>
                  <%= data[i].idBudget %>
                </td>
                <td>
                  <%= data[i].CreationDate %>
                </td>
                <td>
                  <%= data[i].project %>
                </td>
                <td>
                  <%= data[i].versions %>
                </td>
                <td>
                  <!-- <a href="/update/<%= data[i].id %>" class="btn btn-info">Edit</a>
                  <a href="/delete/<%= data[i].id %>" class="btn btn-danger">Delete</a> -->
                  <a type="button" onclick="getValueInput(<%= data[i].idBudget %>)" class="btn btn-primary "
                    data-bs-toggle="modal" data-bs-target="#modalForm">
                    Editar
                  </a>
                  <a type="button" class="btn btn-danger" href="/delete/<%= data[i].idBudget %>">
                    eliminar
                  </a>

                </td>
              </tr>
              <% } %>
                <% } %>
        </tbody>
      </table>

      <!-- Button trigger modal -->


      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog .bg-dark.bg-gradient">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel"> Estas seguro de eliminar</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary">Aceptar</button>
            </div>
          </div>
        </div>
      </div>



      <!-- Modal -->
      <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel"> crear nuevo presupeusto</h5>
            </div>
            <div>
              <div class="mb-3">
                <label class="form-label">Fecha de creacion</label>
                <!-- <input type="password" class="form-control" id="password" name="password" placeholder="Password" /> -->
                <input type="date" id="startDateCreated" name="trip-start" value="2018-07-22" min="2018-01-01"
                  max="2018-12-31">
              </div>
              <div class="mb-3">
                <label class="form-label">Proyecto</label>
                <input type="text" class="form-control" id="proyectCreated" name="username" placeholder="Username" />
              </div>
              <div class="mb-3">
                <label class="form-label">Versiones</label>
                <input type="number" id="versionsCreated" placeholder="1.0"  value="1" step="1.1" min="1" max="1000">

              </div>
            </div>
            <div class="modal-footer align-items-center">
              <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="createButget()">Aceptar</button>
            </div>
          </div>
        </div>
      </div>


      <!-- Click on Modal Button -->


      <!-- Modal -->
      <div class="modal fade" id="modalForm" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Bootstrap 5 Modal Form</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div>
                <div class="mb-3">
                  <label class="form-label">Fecha de creacion</label>
                  <!-- <input type="password" class="form-control" id="password" name="password" placeholder="Password" /> -->
                  <input type="date" id="startDate" name="trip-start" value="2018-07-22" min="2018-01-01"
                    max="2018-12-31">
                </div>
                <div class="mb-3">
                  <label class="form-label">Proyecto</label>
                  <input type="text" class="form-control" id="proyect" name="username" placeholder="Username" />
                </div>
                <div class="mb-3">
                  <label class="form-label">Versiones</label>
                  <input type="number" id="versions" placeholder="1.0" value="1.1"  step="1.1" min="1" max="1000">

                </div>
                <div class="modal-footer d-block">
                  <p class="float-start">Not yet account <a href="#">Sign Up</a></p>
                  <button type="submit" class="btn btn-warning float-end" onclick="updateButgets()">Submit</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  
  </div>
</div>
</div>
    <script>
      let idButget;
      const getValueInput = (value) => {
        if (value == undefined) {
          return false
        }
        console.log(value);
        //updateButgets(value)
        return idBudget=value;
      }
      const updateButgets = async() => {
        let mydate =document.getElementById("startDate").value
        let butgetsProyect =document.getElementById("proyect").value
        let versionsBut =document.getElementById("versions").value;

          let dataUpdate = {
          idBudget: idBudget,
          dateButget:mydate,
          proyectButgets: butgetsProyect,
          versions:versionsBut
          }
          console.log(dataUpdate);
          let searching = await fetch("http://localhost:3000/updateButgets", {
          method: "POST",
          mode: "cors",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(dataUpdate)
        })
          location.reload();//cargar la paginba
        }
        const createButget=async()=> {
  let dateCreated =document.getElementById("startDateCreated").value
  let proyectName =document.getElementById("proyectCreated").value
  let versionCreate =document.getElementById("versionsCreated").value

  let dataCreate = {
    date: dateCreated,
    proyect:proyectName,
    versions:versionCreate,
   
};
console.log(dataCreate);
  let searching = await fetch("http://localhost:3000/createButgets", {
    method: "POST",
    mode: "cors",
    headers: {
       "Content-Type": "application/json",
    },
    body: JSON.stringify(dataCreate),
  }).then(response =>{ console.log("validacion")
  if (!response.ok) {
    alert("Hubo un error no se encuentra el id")
  }
});
location.reload();
}
    </script>